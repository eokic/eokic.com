---
// TYPES
import type { IGlobal } from '@/interfaces'
interface Props {
  title: string
  description?: string
  pageClass?: string
}

// PROPS
const { title, description, pageClass } = Astro.props

// METHODS
import fetchApi from '@/lib/strapi'
import { googleFonts, markdownToHTML } from '@/utils'

// COMPONENTS
import { Button, Header } from '@/components'
import { Noise } from '@/components/vfx'
import { ViewTransitions } from 'astro:transitions'

// DATA
const globals = await fetchApi<IGlobal>({
  endpoint: 'global',
  query: { populate: 'deep' },
  wrappedByKey: 'data',
})

// MEDIA
import faviconSVG from '@/assets/favicon/favicon.svg'
import faviconICO from '@/assets/favicon/favicon.ico'
import touchIcon from '@/assets/favicon/apple-touch-icon.png'

// STYLES
import '@/styles/eokic.pcss'
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, minimum-scale=1, viewport-fit=cover"
    />
    <title>{title} | {globals.siteName}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com/" crossorigin />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="dns-prefetch" href="https://fonts.googleapis.com" />
    <link
      rel="stylesheet"
      href={googleFonts({
        family: ['Kalam'],
        weight: ['400', '700'],
      })}
    />
    <link href={faviconICO} rel="icon" sizes="32x32" />
    <link href={faviconSVG.src} rel="icon" type="image/svg+xml" />
    <link href={touchIcon.src} rel="apple-touch-icon" />
    <ViewTransitions />
    <meta name="description" content={description || globals.siteDescription} />
    <meta name="generator" content={Astro.generator} />
  </head>
  <body id="top" class:list={[pageClass, 'no-js']}>
    <!-- Accessibilty links -->
    <div class="absolute z-30 top-6 left-6">
      <Button theme="a11y" href="#main" label="Skip to content" />
    </div>

    <script is:inline>
      // JS detection
      document.body.classList.remove('no-js')
      document.body.classList.add('js')
      document.addEventListener('DOMContentLoaded', () => {
        document.body.classList.add('domReady')
      })

      // VFX marker
      setTimeout(() => {
        document.body.classList.add('vfxReady')
      }, 100)

      // App globals
      window.App = {
        prefersReducedMotion: window.matchMedia(
          '(prefers-reduced-motion: reduce)'
        ).matches,
        route: {
          isHomePage: document.body.classList.contains('pg-home'),
          isProjectPage: document.body.classList.contains('pg-project'),
        },
      }
    </script>

    <!-- -------------------------------------------------------------------------
      HEADER
    -------------------------------------------------------------------------- -->
    <Header {globals} />

    <script is:inline>
      function onStrapiImageLoad(localID) {
        document.getElementById(`st-image-${localID}`).classList.add('-loaded')
        setTimeout(() => {
          if (!document.getElementById(`placeholder-${localID}`)) return
          document.getElementById(`placeholder-${localID}`).style.display =
            'none'
        }, 1000)
      }
    </script>

    <!-- -------------------------------------------------------------------------
      NOISE VFX
    -------------------------------------------------------------------------- -->
    <Noise />
    <div
      class="fixed top-0 left-0 w-full h-full opacity-10 pointer-events-none"
      style="filter: url(#noise); mix-blend-mode: multiply;"
    >
    </div>

    <!-- -------------------------------------------------------------------------
      BODY
    -------------------------------------------------------------------------- -->
    <slot />

    <!-- -------------------------------------------------------------------------
      FOOTER
    -------------------------------------------------------------------------- -->
    <footer class="mt-inner mb-section">
      <div class="container">
        <div class:list={['border-t border-dashed border-slate-300 pt-inner']}>
          <div
            class:list={[
              'max-w-none',
              'prose -text-body-1 lh-prose text-slate-500',
            ]}
            set:html={markdownToHTML(globals.footer)}
          />
        </div>
      </div>
    </footer>

    <!-- Scripts -->
    <script src="@/assets/main.ts"></script>
    <script src="flying-focus/flying-focus.js"></script>
  </body>
</html>
